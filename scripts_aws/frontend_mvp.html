<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Téléversement et téléchargement</title>
</head>
<body>
    <h1>Téléversement de vidéos et téléchargement du fichier results.csv</h1>
    
    <!-- Formulaire pour téléverser des vidéos -->
    <form id="upload-form">
        <input type="file" id="video-files" name="video-files" multiple>
        <button type="submit">Téléverser les vidéos</button>
    </form>

    <div id="status"></div>
    <div id="download-section" style="display: none;">
        <p id="download-message"></p>
        <a id="download-link" href="" download> Télécharger results.csv </a>
    </div>

    <script>
        document.getElementById('upload-form').onsubmit = async function(event) {
            event.preventDefault();

            const files = document.getElementById('video-files').files;
            const fileNames = Array.from(files).map(file => file.name);
            const statusDiv = document.getElementById('status');
            
            // Appel à la fonction Lambda pour téléverser les fichiers
            const response = await fetch('https://YOUR_API_LAMBDA_URL/upload', {
                method: 'POST',
                body: JSON.stringify({ video_names: fileNames }),
                headers: { 'Content-Type': 'application/json' }
            });
            
            const data = await response.json();
            const uploadUrls = data.upload_urls;

            // Téléverser chaque vidéo
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const uploadUrl = uploadUrls[i].upload_url;

                await fetch(uploadUrl, {
                    method: 'PUT',
                    body: file
                });
            }

            statusDiv.innerHTML = "Téléversement réussi. Traitement en cours...";

            // Vérification régulière pour savoir si results.csv est prêt
            const checkResults = setInterval(async function() {
                const checkResponse = await fetch('https://YOUR_API_LAMBDA_URL/get-results');
                const checkData = await checkResponse.json();
                
                if (checkResponse.status === 200) {
                    document.getElementById('download-message').innerText = checkData.message;
                    document.getElementById('download-link').href = checkData.download_url;
                    document.getElementById('download-section').style.display = 'block';
                    clearInterval(checkResults);  // Arrêter la vérification
                }
            }, 10000);  // Vérifier toutes les 10 secondes
        };
    </script>
</body>
</html>
